<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="lib/codemirror.css"/>
		<link rel="stylesheet" href="beditor.css"/>
		<script src="lib/jquery.js" type="text/javascript"></script>
		<script src="lib/codemirror.js" type="text/javascript"></script>
		<script src="b.js" type="text/javascript"></script>
	</head>
	<body>
		<div id="container">
			<textarea id="code"></textarea>
		</div>
		<script>
			var TO;
			var lines;
			
			function onChange(cm) {
				var line = cm.getCursor().line;
				if(!blexer.isInitialized()) {
					clearTimeout(TO);
					TO = setTimeout(function(){
						blexer.computeHighlighting(cm.getValue(), line + '');
					}, 500);
				} else {
					if(lines + 1 == cm.lineCount()) {
						line -= 1;
					}
					blexer.computeHighlighting(cm.getValue(), line + '');
				}
			}
			
			function beforeChange(cm) {
				lines = cm.lineCount();
			}

			var code = document.getElementById('code');
			var editor = CodeMirror.fromTextArea(code, {
				lineNumbers: true,
				indentUnit: 4,
				autoCloseBrackets: true,
				matchBrackets: true,
				mode: "text/b"
			});
			
			editor.on("change", onChange);			
			editor.on("beforeChange", beforeChange);
			
			function changeFontSize(size) {
				editor.getWrapperElement().style["font-size"] = size+"px";
				editor.refresh();
			}
		</script>
	</body>
</html>
